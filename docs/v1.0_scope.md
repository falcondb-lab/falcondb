# FalconDB v1.0 Commercial Release — Scope & Verification

> **Positioning**: FalconDB v1.0 is a PG-compatible, distributed, memory-first,
> deterministic transaction semantics OLTP database.
> Benchmarked against SingleStore (OLTP) and VoltDB.

## Status: ✅ ALL GATES PASS

---

## 一、事务内核 (Transaction Kernel)

| ID | Requirement | Status | Tests | Verification |
|----|------------|--------|-------|-------------|
| 1.1a | Atomicity — single-shard | ✅ | 6 | `test_acid_atomicity_commit_visible`, `test_acid_atomicity_rollback_invisible` |
| 1.1b | Consistency — PK/NOT NULL/CHECK enforced | ✅ | 2 | `test_acid_consistency_pk_enforced`, `test_acid_consistency_not_null_enforced` |
| 1.1c | Isolation — Snapshot Isolation (MVCC) | ✅ | 35 | `si_litmus_tests` (B3), `test_acid_isolation_snapshot` |
| 1.1d | Durability — WAL-first + replay idempotent | ✅ | 13 | `recovery_tests` (B4), `test_acid_durability_wal_observer` |
| 1.1e | ACID invariants formalized | ✅ | — | `falcon_common/src/consistency.rs` (§1–§11) |
| 1.2a | 2PC coordinator/participant | ✅ | 20 | `indoubt_resolver` tests (B2) |
| 1.2b | Coordinator crash recovery | ✅ | — | `XS_3_COORDINATOR_CRASH_RECOVERY` invariant |
| 1.2c | Participant crash recovery | ✅ | — | `XS_4_PARTICIPANT_CRASH_RECOVERY` invariant |
| 1.2d | Duplicate commit idempotent | ✅ | — | `XS_2_AT_MOST_ONCE` invariant + tests |
| 1.2e | In-doubt auto-cleanup | ✅ | 20 | `InDoubtResolver` sweep/background tests |
| 1.3a | Single-shard never enters 2PC | ✅ | 28 | B1 state machine: `LocalTxn cannot enter Prepared` |
| 1.3b | Path selection at planner | ✅ | — | `TxnClassification` in `manager.rs` |
| 1.3c | Fast-path metrics | ✅ | 1 | `test_fast_path_stats_visible` |

## 二、复制 / 高可用 (Replication / HA)

| ID | Requirement | Status | Tests | Verification |
|----|------------|--------|-------|-------------|
| 2.1a | Commit visibility boundary | ✅ | — | `consistency.rs` §1 CommitPoint model |
| 2.1b | Sync/async replication | ✅ | — | `CommitPolicy` enum (4 policies) |
| 2.1c | Quorum strategy | ✅ | — | `PrimaryPlusReplicaAck { required_acks }` |
| 2.1d | No double commit | ✅ | — | `REP_2_NO_PHANTOM_COMMITS` invariant |
| 2.1e | No phantom write | ✅ | — | `REP_1_PREFIX_PROPERTY` invariant |
| 2.2a | Failover CI gate | ✅ | — | `scripts/ci_failover_gate.sh` |
| 2.2b | Fencing invariant | ✅ | — | `FAIL_3_FENCING` + epoch guard |

## 三、SQL / PG 兼容 (SQL Whitelist)

| ID | Requirement | Status | Tests | Verification |
|----|------------|--------|-------|-------------|
| 3.1a | SELECT/INSERT/UPDATE/DELETE | ✅ | 232 | `falcon_protocol_pg` handler tests |
| 3.1b | JOIN (inner/left) | ✅ | 2 | `test_sql_join_inner`, `test_sql_join_left` |
| 3.1c | ORDER BY / LIMIT | ✅ | 1 | `test_sql_order_by_limit` |
| 3.1d | GROUP BY + aggregates | ✅ | 1 | `test_sql_group_by_aggregate` |
| 3.1e | UPSERT (ON CONFLICT) | ✅ | 1 | `test_sql_upsert_on_conflict` |
| 3.1f | RETURNING clause | ✅ | 2 | `test_sql_update_returning`, `test_sql_delete_returning` |
| 3.1g | Simple Query protocol | ✅ | 232 | All handler tests use simple query |
| 3.1h | Extended Query protocol | ✅ | — | `falcon_protocol_pg/src/extended.rs` |
| 3.1i | Transaction state machine | ✅ | 12 | B8 PG protocol corner case tests |
| 3.2a | Unsupported → clear error | ✅ | 2 | `test_unsupported_create_trigger_error`, `test_unsupported_create_function_error` |
| 3.2b | Unsupported list in README | ✅ | — | README "v1.0 Not Supported" table with SQLSTATE codes |

## 四、性能与稳定性 (Performance)

| ID | Requirement | Status | Tests | Verification |
|----|------------|--------|-------|-------------|
| 4.1a | YCSB-A benchmark | ✅ | — | `falcon_bench` with `--seed 42` |
| 4.1b | Reproducible (< 5% jitter) | ✅ | — | `--baseline-check` regression gate |
| 4.1c | Scale-out TPS monotonicity | ✅ | — | `--scaleout` + 5% tolerance assertion |
| 4.2a | p50/p99/max metrics | ✅ | — | `SHOW falcon.txn_stats` |
| 4.2b | Abort rate tracking | ✅ | — | `total_aborted` / `occ_conflicts` metrics |
| 4.2c | CI perf gate | ✅ | — | `scripts/ci_perf_gate.sh` |

## 五、运维与可观测 (Observability)

| ID | Requirement | Status | Tests | Verification |
|----|------------|--------|-------|-------------|
| 5.1a | Txn path distribution | ✅ | 1 | `SHOW falcon.txn_stats` → `fast_path_commits` / `slow_path_commits` |
| 5.1b | Replication lag | ✅ | 1 | `SHOW falcon.replication_stats` |
| 5.1c | Memory usage | ✅ | 1 | `SHOW falcon.memory` |
| 5.1d | WAL backlog | ✅ | 1 | `SHOW falcon.wal_stats` |
| 5.2a | SHOW falcon.nodes | ✅ | 1 | `test_show_nodes` |
| 5.2b | SHOW falcon.txn_stats | ✅ | 1 | `test_show_txn_stats` |
| 5.2c | Prometheus metrics | ✅ | — | `falcon_observability` crate |

## 六、JDBC 客户端 (Client)

| ID | Requirement | Status | Tests | Verification |
|----|------------|--------|-------|-------------|
| 6.1 | falcondb-jdbc (CRUD + Txn + PreparedStatement) | ✅ | — | `clients/falcondb-jdbc/`, `scripts/ci_jdbc_smoke.sh` |

## 七、v1.0 Scope Guard (禁止事项)

| Forbidden Feature | Enforcement | Verified |
|-------------------|-------------|----------|
| HTAP / ColumnStore | `feature = "columnstore"` off by default | ✅ |
| Automatic rebalancing | Not implemented | ✅ |
| Raft strong-consistency | `falcon_raft` isolated, stub only | ✅ |
| Disk tier / spill | `feature = "disk_rowstore"` off by default | ✅ |
| Online DDL | Stub only, returns error | ✅ |

## Isolation Module (B1–B10)

| ID | Item | Status | Tests |
|----|------|--------|-------|
| B1 | Txn state machine — `TxnState::try_transition()` | ✅ | 28 |
| B2 | In-doubt resolver crash matrix | ✅ | 20 |
| B3 | Snapshot Isolation litmus tests | ✅ | 35 |
| B4 | WAL-first durability + replay idempotency | ✅ | 13 |
| B5 | Replication lag backpressure | ✅ | 5 |
| B6 | Memory budget admission control | ✅ | 5 |
| B7 | Tail latency — long-txn detection + kill | ✅ | 9 |
| B8 | PG protocol corner cases | ✅ | 12 |
| B9 | DDL concurrency safety | ✅ | 8 |
| B10 | Crash matrix CI gate | ✅ | — |

## CI Gates

```bash
# Isolation module gate (B1–B9)
./scripts/ci_isolation_gate.sh

# Full v1.0 release gate (all sections)
./scripts/ci_v1_release_gate.sh

# Performance regression gate
./scripts/ci_perf_gate.sh

# Failover gate
./scripts/ci_failover_gate.sh
```

## Go / No-Go Criteria

All of the following must be satisfied before tagging v1.0.0:

- [x] `cargo test --workspace` — all green
- [x] `scripts/ci_v1_release_gate.sh` — all gates pass
- [x] `scripts/ci_perf_gate.sh` — benchmark stable
- [x] README positioning statement — no overstatement
- [x] Unsupported features documented with SQLSTATE codes
- [x] Transaction / replication semantics formalized in `consistency.rs`
- [x] Scope guard enforced (feature-off for prohibited capabilities)
